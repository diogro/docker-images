# Copyright (c) by Diogo Melo
# Distributed under the terms of the MIT License.

FROM jupyter/r-notebook

MAINTAINER Diogo Melo <diogro@gmail.com>

# Install system libraries first as root
USER root

# R dependencies that conda can't provide (X, fonts, compilers)
RUN apt-get update && \
    apt-get install -y libxrender1 fonts-dejavu gfortran gcc mesa-common-dev libglu1-mesa-dev libgl1-mesa-dev && \
    apt-get clean

# Now switch to jovyan for all conda and other package manager installs
USER jovyan

# Install MCMCglmm
RUN R -e 'install.packages("MCMCglmm", repos="http://cran.us.r-project.org")'

# Install evolqg dependencies
RUN R -e 'source("http://bioconductor.org/biocLite.R"); biocLite(c("graph", "Rgraphviz", "Biostrings"))'

RUN conda install --yes r-rgl && conda clean -yt

RUN R -e 'install.packages("igraph", repos="http://cran.us.r-project.org")'
RUN R -e 'install.packages("Matrix", repos="http://cran.us.r-project.org")'
RUN R -e 'install.packages("vegan", repos="http://cran.us.r-project.org")'
RUN R -e 'install.packages("ape", repos="http://cran.us.r-project.org")'
RUN R -e 'install.packages("phytools", repos="http://cran.us.r-project.org")'
RUN R -e 'install.packages("mvtnorm", repos="http://cran.us.r-project.org")'
RUN R -e 'install.packages("coda", repos="http://cran.us.r-project.org")'
RUN R -e 'install.packages("depth", repos="http://cran.us.r-project.org")'
RUN R -e 'install.packages("MCMCpack", repos="http://cran.us.r-project.org")'

# Install evolqg from source
COPY evolqg_0.2-3.tar.gz /home/jovyan
rUN R -e 'install.packages("/home/jovyan/evolqg_0.2-3.tar.gz", repos=NULL, type = "source")'
